<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>OSINT Intelligence Workbench</title>

<link rel="manifest" href="manifest.json">

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

<style>
:root{
  --bg:#05070e;
  --panel:#0f172a;
  --card:#0b1220;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --accent:#38bdf8;
  --border:#1f2937;
  --shadow:rgba(0,0,0,.35);
}

/* LIGHT THEME */
.light{
  --bg:#f3f4f6;
  --panel:#ffffff;
  --card:#ffffff;
  --text:#020617;
  --muted:#4b5563;
  --accent:#0ea5e9;
  --border:#e5e7eb;
  --shadow:rgba(0,0,0,.08);
}

html,body{
  margin:0;
  height:100%;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:var(--bg);
  color:var(--text);
}
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

/* APP LAYOUT */
.app{
  height:100vh;
  display:flex;
}

/* SIDEBAR */
.sidebar{
  width:230px;
  background:var(--panel);
  border-right:1px solid var(--border);
  padding:14px 10px;
  display:flex;
  flex-direction:column;
  box-shadow:4px 0 18px var(--shadow);
  gap:12px;
}

.logo{
  font-size:18px;
  font-weight:700;
  text-align:center;
}

/* ICON GRID NAV */
.navgrid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}

.navbtn{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:6px;
  padding:10px 6px;
  background:var(--card);
  border-radius:14px;
  border:1px solid var(--border);
  cursor:pointer;
  transition:.25s;
}
.navbtn:hover{
  transform:translateY(-2px);
  box-shadow:0 8px 20px var(--shadow);
}
.navbtn.active{
  background:var(--accent);
  color:#020617;
}
.icon{
  font-size:18px;
}

/* THEME TOGGLE */
.theme-toggle{
  margin-top:auto;
  padding:10px;
  text-align:center;
  border-radius:12px;
  border:1px solid var(--border);
  background:var(--card);
  cursor:pointer;
}

/* MAIN PANEL */
.main{
  flex:1;
  overflow-y:auto;
  padding:18px;
}

/* CONTENT SECTIONS */
section{
  display:none;
  background:var(--card);
  border-radius:18px;
  border:1px solid var(--border);
  padding:16px;
  animation:fade .35s ease;
}
section.active{display:block;}

@keyframes fade{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:none}
}

/* INPUTS */
textarea,input{
  background:var(--panel);
  color:var(--text);
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px;
  width:100%;
  box-sizing:border-box;
}

/* KEYWORD TAGS */
.keyword-pill{
  padding:8px 12px;
  background:#042f2e;
  border-radius:999px;
  border:1px solid #0d9488;
  display:inline-block;
  margin:3px;
  cursor:pointer;
}

/* CANVAS PANELS */
.graphBox,#mapCanvas,#keywordChart{
  border:1px solid var(--border);
  border-radius:16px;
  background:var(--panel);
  width:100%;
}

/* ATTACHMENTS */
.attachment{
  border:1px solid var(--border);
  border-radius:14px;
  padding:10px;
  margin:6px 0;
  background:var(--panel);
}

/* HEATMAP */
.heat{
  display:grid;
  grid-template-columns:repeat(32,1fr);
  gap:2px;
}
.heat div{
  width:10px;
  height:10px;
  border-radius:3px;
}
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  
</style>
</head>
<script>
document.addEventListener("DOMContentLoaded", function() {
  console.log("JS ready");
});
</script>

<body>
<div id="lockscreen" style="position:fixed;inset:0;background:#020617;display:flex;align-items:center;justify-content:center;z-index:9999">
  <div style="background:#0f172a;border:1px solid #1f2937;padding:26px 22px;border-radius:18px;max-width:360px;width:92%;text-align:center">

    <h2>üîí OSINT Workbench</h2>
    <p id="lockTitle" style="margin-top:6px;margin-bottom:18px"></p>

    <div id="setupBox">
      <input type="password" id="setPass1" placeholder="Create password" style="width:100%;margin-bottom:10px">
      <input type="password" id="setPass2" placeholder="Confirm password" style="width:100%;margin-bottom:14px">
      <button onclick="createPassword()">Save Password</button>
      <p id="setupMsg" style="color:#f87171;margin-top:10px"></p>
    </div>

    <div id="loginBox">
      <input type="password" id="loginPass" placeholder="Enter password" style="width:100%;margin-bottom:14px">
      <button onclick="unlock()">Unlock</button>
      <p id="loginMsg" style="color:#f87171;margin-top:10px"></p>
    </div>

  </div>
</div>

  
<div class="app">
<section id="pdfextract">
<h2>Offline PDF Text Extractor</h2>

<input type="file" id="pdfFile" accept="application/pdf">
<button onclick="extractPdf()">Extract Text</button>

<textarea id="pdfOutput" style="height:40vh"></textarea>
</section>

<!-- SIDEBAR -->
<div class="sidebar">
<div class="navbtn" data-target="pdfextract"><div class="icon">üìï</div><span>PDF</span></div>

<div class="logo">üïµ OSINT Workbench</div>

<div class="navgrid">

<div class="navbtn active" data-target="vaults"><div class="icon">üìÇ</div><span>Vaults</span></div>
<div class="navbtn" data-target="keywords"><div class="icon">üîë</div><span>Keywords</span></div>
<div class="navbtn" data-target="graph"><div class="icon">üï∏</div><span>Graph</span></div>
<div class="navbtn" data-target="matrix"><div class="icon">üßÆ</div><span>Matrix</span></div>
<div class="navbtn" data-target="entities"><div class="icon">üß†</div><span>Entities</span></div>
<div class="navbtn" data-target="calendar"><div class="icon">üìÖ</div><span>Calendar</span></div>
<div class="navbtn" data-target="attachments"><div class="icon">üìé</div><span>Files</span></div>
<div class="navbtn" data-target="map"><div class="icon">üó∫Ô∏è</div><span>Map</span></div>
<div class="navbtn" data-target="markdown"><div class="icon">üìù</div><span>Notes</span></div>
<div class="navbtn" data-target="compare"><div class="icon">‚öñÔ∏è</div><span>Compare</span></div>
<div class="navbtn" data-target="themes"><div class="icon">üé®</div><span>Theme</span></div>
<div class="navbtn" data-target="report"><div class="icon">üìÑ</div><span>Reports</span></div>

</div>

<div class="theme-toggle" onclick="toggleTheme()">üåó Toggle light / dark</div>

</div>

<!-- MAIN CONTENT -->
<div class="main">

<!-- all sections remain same functionality -->

<section id="vaults" class="active">
<h2>Projects / Vaults</h2>
<input id="newVaultName" placeholder="New vault name">
<button onclick="createVault()">Create</button>
<div id="vaultList"></div>
</section>

<section id="keywords">
<h2>Keywords</h2>
<div id="keywordBox"></div>
<canvas id="keywordChart" width="360" height="220"></canvas>
<div id="keywordResults"></div>
</section>

<section id="graph">
<h2>Keyword Graph</h2>
<div class="graphBox">
<canvas id="graphCanvas" width="360" height="340"></canvas>
</div>
</section>

<section id="matrix">
<h2>Co-occurrence Matrix</h2>
<div id="matrixBox"></div>
</section>

<section id="entities">
<h2>Entity Detection</h2>
<div id="entityBox"></div>
</section>

<section id="calendar">
<h2>Keyword Activity Calendar</h2>
<input id="calKey" placeholder="keyword">
<button onclick="drawCalendar()">Show</button>
<div id="calendarBox"></div>
</section>

<section id="attachments">
<h2>Attachments</h2>
<input type="file" id="filePicker" multiple>
<button onclick="addAttachments()">Add</button>
<div id="attachmentList"></div>
</section>

<section id="map">
<h2>Geo Map</h2>
<canvas id="mapCanvas" width="360" height="260"></canvas>
</section>

<section id="markdown">
<h2>Markdown Notebook</h2>
<textarea id="mdInput" placeholder="# Write markdown‚Ä¶"></textarea>
<button onclick="togglePreview()">Toggle Preview</button>
<div id="mdPreview" style="display:none"></div>
</section>

<section id="compare">
<h2>Side-by-Side Compare</h2>
<textarea id="leftText" placeholder="Text A‚Ä¶"></textarea>
<textarea id="rightText" placeholder="Text B‚Ä¶"></textarea>
<button onclick="compareTexts()">Compare</button>
<div id="compareResult"></div>
</section>

<section id="themes">
<h2>Theme Builder</h2>
<label>Background</label><input type="color" id="bgCol">
<label>Foreground</label><input type="color" id="fgCol">
<label>Accent</label><input type="color" id="acCol">
<button onclick="applyTheme()">Apply</button>
</section>

<section id="report">
<h2>Report Generator</h2>
<select id="reportType">
<option>Incident Summary</option>
<option>Country Situation Brief</option>
<option>Entity Profile</option>
</select>
<button onclick="generateReport()">Generate</button>
<textarea id="reportOut" style="height:40vh"></textarea>
</section>

<section id="export">
<h2>Export / Import Vault</h2>
<button onclick="exportVault()">Export current vault</button><br><br>
<input type="file" id="importFile">
<button onclick="importVault()">Import vault</button>
</section>
async function extractPdf(){
  const file = document.getElementById("pdfFile").files[0];
  if(!file) return;

  const array = await file.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({data: array}).promise;

  let out = "";

  for(let i=1;i<=pdf.numPages;i++){
    const page = await pdf.getPage(i);
    const text = await page.getTextContent();
    out += text.items.map(t => t.str).join(" ") + "\n\n";
  }

  document.getElementById("pdfOutput").value = out;
}
const PASSWORD_HASH_KEY = "osint_password_hash";

/* ---------- INITIAL MODE SETUP ---------- */

window.addEventListener("load", ()=>{
  const stored = localStorage.getItem(PASSWORD_HASH_KEY);

  if(!stored){
    // first time ‚Üí SETUP MODE
    document.getElementById("setupBox").style.display = "block";
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("lockTitle").innerText = "Set your password";
  } else {
    // later ‚Üí LOGIN MODE
    document.getElementById("setupBox").style.display = "none";
    document.getElementById("loginBox").style.display = "block";
    document.getElementById("lockTitle").innerText = "Enter password";
  }
});

/* ---------- CREATE PASSWORD ---------- */

function createPassword(){
  const p1 = document.getElementById("setPass1").value;
  const p2 = document.getElementById("setPass2").value;

  if(!p1 || !p2){
    document.getElementById("setupMsg").innerText = "Password fields cannot be empty.";
    return;
  }

  if(p1 !== p2){
    document.getElementById("setupMsg").innerText = "Passwords do not match.";
    return;
  }

  const hash = CryptoJS.SHA256(p1).toString();
  localStorage.setItem(PASSWORD_HASH_KEY, hash);

  document.getElementById("lockscreen").style.display = "none";
}

/* ---------- UNLOCK ---------- */

function unlock(){
  const entered = document.getElementById("loginPass").value;
  const stored = localStorage.getItem(PASSWORD_HASH_KEY);

  if(!stored){
    document.getElementById("loginMsg").innerText = "No password set.";
    return;
  }

  const hash = CryptoJS.SHA256(entered).toString();

  if(hash === stored){
    document.getElementById("lockscreen").style.display = "none";
  } else {
    document.getElementById("loginMsg").innerText = "Incorrect password.";
  }
}

});

</div></div>

<script>
/* Sidebar navigation */
document.querySelectorAll('.navbtn').forEach(b=>{
 b.onclick=()=>{
  document.querySelectorAll('.navbtn').forEach(x=>x.classList.remove('active'));
  document.querySelectorAll('section').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  document.getElementById(b.dataset.target).classList.add('active');
 };
<div class="theme-toggle" onclick="localStorage.removeItem('osint_password_hash');location.reload();">
  üîÅ Reset password / Logout
</div>

});
<div class="theme-toggle" onclick="localStorage.removeItem('osint_password_hash');location.reload();">
  üö™ Logout / Reset password
</div>

/* Light / dark theme */
function toggleTheme(){
 document.body.classList.toggle("light");
}

/* ---- existing JS logic from previous version retained ---- */
/* vaults setup, keywords, graph, matrix, etc. remain unchanged */
/* (everything you already had below this continues to work) */

/* Vaults */
let vaults=JSON.parse(localStorage.getItem("vaults")||"{}");
let currentVault=localStorage.getItem("currentVault")||"default";
if(!vaults[currentVault]) vaults[currentVault]={notes:[],feeds:[]};
saveVaults();

function saveVaults(){
 localStorage.setItem("vaults",JSON.stringify(vaults));
 localStorage.setItem("currentVault",currentVault);
 renderVaults();
 rebuildEverything();
}
function createVault(){
 const n=document.getElementById("newVaultName").value.trim();
 if(!n) return;
 vaults[n]={notes:[],feeds:[]};
 currentVault=n;
 saveVaults();
}
function renderVaults(){
 const box=document.getElementById("vaultList");
 box.innerHTML="";
 Object.keys(vaults).forEach(v=>{
  const btn=document.createElement("button");
  btn.textContent=v+(v===currentVault?" ‚úì":"");
  btn.onclick=()=>{currentVault=v;saveVaults();};
  box.appendChild(btn);
 });
}
const PASSWORD_HASH_KEY = "osint_password_hash";

function setPassword(){
  const p = prompt("Set a new password:");
  if(!p) return;
  const hash = CryptoJS.SHA256(p).toString();
  localStorage.setItem(PASSWORD_HASH_KEY, hash);
  alert("Password set. Remember it!");
}

function unlock(){
  const input = document.getElementById("lockPass").value;
  const stored = localStorage.getItem(PASSWORD_HASH_KEY);

  if(!stored){
    setPassword();
    document.getElementById("lockscreen").style.display="none";
    return;
  }

  const hash = CryptoJS.SHA256(input).toString();

  if(hash === stored){
    document.getElementById("lockscreen").style.display="none";
  } else {
    document.getElementById("lockMsg").innerText = "‚ùå Wrong password. Try again.";
  }
}

window.addEventListener("load", ()=>{
  const stored = localStorage.getItem(PASSWORD_HASH_KEY);
  if(!stored){
    document.getElementById("lockMsg").innerText = "Create password";
  }
});

/* Helper functions, analytics, attachments, etc. remain same as before */
/* (they were included earlier and still work with new UI) */

</script>
</body>
</html>
