<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OSINT Intelligence Workbench</title>

<link rel="manifest" href="manifest.json">

<!-- Service worker -->
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

<style>
:root{
  --bg:#05070e;
  --panel:#0f172a;
  --card:#0b1220;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --accent:#38bdf8;
  --border:#1f2937;
  --shadow:rgba(0,0,0,.35);
}

/* LIGHT THEME */
.light{
  --bg:#f3f4f6;
  --panel:#ffffff;
  --card:#ffffff;
  --text:#020617;
  --muted:#4b5563;
  --accent:#0ea5e9;
  --border:#e5e7eb;
  --shadow:rgba(0,0,0,.08);
}

html,body{
  margin:0;
  height:100%;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:var(--bg);
  color:var(--text);
}

/* APP LAYOUT */
.app{
  height:100vh;
  display:flex;
}

/* SIDEBAR */
.sidebar{
  width:230px;
  background:var(--panel);
  border-right:1px solid var(--border);
  padding:14px 10px;
  display:flex;
  flex-direction:column;
  box-shadow:4px 0 18px var(--shadow);
  gap:12px;
}

.logo{
  font-size:18px;
  font-weight:700;
  text-align:center;
}

/* ICON GRID NAV */
.navgrid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}

.navbtn{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:6px;
  padding:10px 6px;
  background:var(--card);
  border-radius:14px;
  border:1px solid var(--border);
  cursor:pointer;
  transition:.25s;
}
.navbtn:hover{
  transform:translateY(-2px);
  box-shadow:0 8px 20px var(--shadow);
}
.navbtn.active{
  background:var(--accent);
  color:#020617;
}

/* THEME TOGGLE */
.theme-toggle{
  margin-top:auto;
  padding:10px;
  text-align:center;
  border-radius:12px;
  border:1px solid var(--border);
  background:var(--card);
  cursor:pointer;
}

/* MAIN PANEL */
.main{
  flex:1;
  overflow-y:auto;
  padding:18px;
}

/* CONTENT SECTIONS */
section{
  display:none;
  background:var(--card);
  border-radius:18px;
  border:1px solid var(--border);
  padding:16px;
}
section.active{display:block;}

/* INPUTS */
textarea,input{
  background:var(--panel);
  color:var(--text);
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px;
  width:100%;
  box-sizing:border-box;
}

/* HEATMAP */
.heat{
  display:grid;
  grid-template-columns:repeat(32,1fr);
  gap:2px;
}
</style>
</head>

<body>

<!-- LOCKSCREEN -->
<div id="lockscreen" style="position:fixed;inset:0;background:#020617;display:flex;align-items:center;justify-content:center;z-index:9999">
  <div style="background:#0f172a;border:1px solid #1f2937;padding:26px 22px;border-radius:18px;max-width:360px;width:92%;text-align:center">

    <h2>ğŸ”’ OSINT Workbench</h2>
    <p id="lockTitle" style="margin-top:6px;margin-bottom:18px"></p>

    <!-- SETUP MODE -->
    <div id="setupBox">
      <input type="password" id="setPass1" placeholder="Create password" style="width:100%;margin-bottom:10px">
      <input type="password" id="setPass2" placeholder="Confirm password" style="width:100%;margin-bottom:14px">
      <button onclick="createPassword()">Save Password</button>
      <p id="setupMsg" style="color:#f87171;margin-top:10px"></p>
    </div>

    <!-- LOGIN MODE -->
    <div id="loginBox">
      <input type="password" id="loginPass" placeholder="Enter password" style="width:100%;margin-bottom:14px">
      <button onclick="unlock()">Unlock</button>
      <p id="loginMsg" style="color:#f87171;margin-top:10px"></p>
    </div>

  </div>
</div>

<div class="app">

<!-- SIDEBAR -->
<div class="sidebar">

<div class="logo">ğŸ•µ OSINT Workbench</div>

<div class="navgrid">
  <div class="navbtn active" data-target="vaults">ğŸ“‚ Vaults</div>
  <div class="navbtn" data-target="keywords">ğŸ”‘ Keywords</div>
  <div class="navbtn" data-target="graph">ğŸ•¸ Graph</div>
  <div class="navbtn" data-target="matrix">ğŸ§® Matrix</div>
  <div class="navbtn" data-target="entities">ğŸ§  Entities</div>
  <div class="navbtn" data-target="calendar">ğŸ“… Calendar</div>
  <div class="navbtn" data-target="attachments">ğŸ“ Files</div>
  <div class="navbtn" data-target="map">ğŸ—ºï¸ Map</div>
  <div class="navbtn" data-target="markdown">ğŸ“ Notes</div>
  <div class="navbtn" data-target="compare">âš–ï¸ Compare</div>
  <div class="navbtn" data-target="report">ğŸ“„ Reports</div>
  <div class="navbtn" data-target="pdfextract">ğŸ“• PDF</div>
</div>

<div class="theme-toggle" onclick="toggleTheme()">ğŸŒ— Toggle light / dark</div>

<div class="theme-toggle" onclick="resetPassword()">ğŸ” Reset password</div>

</div>

<!-- MAIN -->
<div class="main">

<section id="vaults" class="active">
  <h2>Vaults</h2>
  <input id="newVaultName" placeholder="New vault name">
  <button onclick="createVault()">Create</button>
  <div id="vaultList"></div>
</section>

<section id="pdfextract">
  <h2>Offline PDF Extractor</h2>
  <input type="file" id="pdfFile" accept="application/pdf">
  <button onclick="extractPdf()">Extract</button>
  <textarea id="pdfOutput" style="height:40vh"></textarea>
</section>

<!-- (keep your other sections; omitted here for brevity but still work) -->

</div>
</div>

<script>
/* ---------------- PASSWORD SYSTEM ---------------- */

const PASSWORD_HASH_KEY = "osint_password_hash";

document.addEventListener("DOMContentLoaded", () => {
  const stored = localStorage.getItem(PASSWORD_HASH_KEY);

  if(!stored){
    document.getElementById("setupBox").style.display = "block";
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("lockTitle").innerText = "Set your password";
  } else {
    document.getElementById("setupBox").style.display = "none";
    document.getElementById("loginBox").style.display = "block";
    document.getElementById("lockTitle").innerText = "Enter password";
  }
});

function createPassword(){
  const p1 = document.getElementById("setPass1").value;
  const p2 = document.getElementById("setPass2").value;

  if(!p1 || !p2){
    document.getElementById("setupMsg").innerText = "Fields cannot be empty";
    return;
  }
  if(p1 !== p2){
    document.getElementById("setupMsg").innerText = "Passwords do not match";
    return;
  }

  localStorage.setItem(PASSWORD_HASH_KEY, CryptoJS.SHA256(p1).toString());
  document.getElementById("lockscreen").style.display = "none";
}

function unlock(){
  const stored = localStorage.getItem(PASSWORD_HASH_KEY);
  const entered = CryptoJS.SHA256(document.getElementById("loginPass").value).toString();

  if(entered === stored){
    document.getElementById("lockscreen").style.display = "none";
  } else {
    document.getElementById("loginMsg").innerText = "Incorrect password";
  }
}

function resetPassword(){
  localStorage.removeItem(PASSWORD_HASH_KEY);
  location.reload();
}

/* ---------------- THEME ---------------- */
function toggleTheme(){
  document.body.classList.toggle("light");
}

/* ---------------- NAVIGATION ---------------- */
document.querySelectorAll(".navbtn").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll(".navbtn").forEach(x=>x.classList.remove("active"));
    document.querySelectorAll("section").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    document.getElementById(b.dataset.target).classList.add("active");
  };
});

/* ---------------- PDF EXTRACT ---------------- */
async function extractPdf(){
  const file=document.getElementById("pdfFile").files[0];
  if(!file) return;
  const array=await file.arrayBuffer();
  const pdf=await pdfjsLib.getDocument({data:array}).promise;
  let out="";
  for(let i=1;i<=pdf.numPages;i++){
    let page=await pdf.getPage(i);
    let text=await page.getTextContent();
    out+=text.items.map(t=>t.str).join(" ")+"\n\n";
  }
  document.getElementById("pdfOutput").value=out;
}
</script>

</body>
</html>
