<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OSINT Intelligence Workbench</title>

<link rel="manifest" href="manifest.json">

<!-- Service worker (optional) -->
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>

<style>
:root{
  --bg:#05070e;
  --panel:#0f172a;
  --card:#0b1220;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --accent:#38bdf8;
  --border:#1f2937;
  --shadow:rgba(0,0,0,.35);
}

.light{
  --bg:#f3f4f6;
  --panel:#ffffff;
  --card:#ffffff;
  --text:#020617;
  --muted:#4b5563;
  --accent:#0ea5e9;
  --border:#e5e7eb;
  --shadow:rgba(0,0,0,.08);
}

html,body{
  margin:0;
  height:100%;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
}

/* LOGIN SCREEN */
#loginScreen{
  position:fixed;
  inset:0;
  background:#020617;
  display:flex;
  align-items:center;
  justify-content:center;
}

.login-box{
  background:var(--panel);
  border:1px solid var(--border);
  padding:28px;
  border-radius:16px;
  text-align:center;
  width:320px;
}

/* APP LAYOUT */
.app{
  height:100vh;
  display:none;
}

.sidebar{
  width:230px;
  background:var(--panel);
  border-right:1px solid var(--border);
  padding:14px 10px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.logo{
  font-weight:700;
  text-align:center;
}

.navgrid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}

.navbtn{
  background:var(--card);
  border:1px solid var(--border);
  padding:10px;
  border-radius:14px;
  cursor:pointer;
  text-align:center;
}
.navbtn.active{
  background:var(--accent);
  color:black;
}

.main{
  flex:1;
  overflow:auto;
  padding:16px;
}

section{
  display:none;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:18px;
  padding:16px;
}
section.active{display:block;}

button{
  padding:8px 14px;
  border-radius:10px;
  border:1px solid var(--border);
  background:var(--panel);
  color:var(--text);
  cursor:pointer;
}

textarea,input{
  width:100%;
  background:var(--panel);
  border-radius:12px;
  padding:10px;
  border:1px solid var(--border);
  color:var(--text);
}
</style>
</head>

<body>

<!-- GOOGLE LOGIN SCREEN -->
<div id="loginScreen">
  <div class="login-box">
    <h2>ðŸ•µ OSINT Workbench</h2>
    <p>Sign in with Google to continue</p>
    <button onclick="googleLogin()">ðŸ”‘ Sign in with Google</button>
    <p id="loginStatus" style="color:#9ca3af;margin-top:10px;"></p>
  </div>
</div>

<!-- APP -->
<div class="app" id="app">

<div class="sidebar">
  <div class="logo">OSINT Workbench</div>

  <div id="userEmail" style="font-size:12px;text-align:center;color:var(--muted)"></div>

  <div class="navgrid">
    <div class="navbtn active" data-target="vaults">ðŸ“‚ Vaults</div>
    <div class="navbtn" data-target="pdfextract">ðŸ“• PDF</div>
  </div>

  <div class="navbtn" onclick="logout()">ðŸšª Logout</div>
  <div class="navbtn" onclick="toggleTheme()">ðŸŒ— Theme</div>
</div>

<div class="main">

<section id="vaults" class="active">
  <h2>Vaults</h2>
  <input id="newVaultName" placeholder="New vault name">
  <button onclick="createVault()">Create</button>
  <div id="vaultList"></div>
</section>

<section id="pdfextract">
  <h2>Offline PDF Extractor</h2>
  <input type="file" id="pdfFile" accept="application/pdf">
  <button onclick="extractPdf()">Extract</button>
  <textarea id="pdfOutput" style="height:40vh"></textarea>
</section>

</div>
</div>

<script>
/* ---------------- FIREBASE CONFIG ---------------- */
/* REPLACE WITH YOUR OWN VALUES */

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();

/* ---------------- LOGIN LOGIC ---------------- */

function googleLogin(){
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider)
  .then(result=>{
    document.getElementById("loginStatus").innerText="Logged in";
  })
  .catch(e=>{
    document.getElementById("loginStatus").innerText=e.message;
  });
}

function logout(){
  auth.signOut();
}

/* auth state observer */
auth.onAuthStateChanged(user=>{
  if(user){
    document.getElementById("loginScreen").style.display="none";
    document.getElementById("app").style.display="flex";
    document.getElementById("userEmail").innerText=user.email;
  } else {
    document.getElementById("app").style.display="none";
    document.getElementById("loginScreen").style.display="flex";
  }
});

/* ---------------- THEME ---------------- */
function toggleTheme(){
  document.body.classList.toggle("light");
}

/* ---------------- NAVIGATION ---------------- */
document.querySelectorAll(".navbtn").forEach(b=>{
  if(b.dataset.target){
    b.onclick=()=>{
      document.querySelectorAll(".navbtn").forEach(x=>x.classList.remove("active"));
      document.querySelectorAll("section").forEach(x=>x.classList.remove("active"));

      b.classList.add("active");
      document.getElementById(b.dataset.target).classList.add("active");
    };
  }
});

/* ---------------- LOCAL VAULT STORAGE ---------------- */

let vaults = JSON.parse(localStorage.getItem("vaults") || "{}");
let currentVault = "default";

function saveVaults(){
  localStorage.setItem("vaults", JSON.stringify(vaults));
  renderVaults();
}

function createVault(){
  const n=document.getElementById("newVaultName").value.trim();
  if(!n) return;
  vaults[n]={notes:[]};
  currentVault=n;
  saveVaults();
}

function renderVaults(){
  const box=document.getElementById("vaultList");
  box.innerHTML="";
  Object.keys(vaults).forEach(v=>{
    const btn=document.createElement("button");
    btn.textContent=v+(v===currentVault?" âœ“":"");
    btn.onclick=()=>{currentVault=v;saveVaults()};
    box.appendChild(btn);
  });
}
renderVaults();

/* ---------------- PDF EXTRACTION ---------------- */
async function extractPdf(){
  const file=document.getElementById("pdfFile").files[0];
  if(!file) return;

  const array=await file.arrayBuffer();
  const pdf=await pdfjsLib.getDocument({data:array}).promise;

  let out="";
  for(let i=1;i<=pdf.numPages;i++){
    const page=await pdf.getPage(i);
    const text=await page.getTextContent();
    out+=text.items.map(t=>t.str).join(" ")+"\n\n";
  }

  document.getElementById("pdfOutput").value=out;
}
</script>

</body>
</html>
